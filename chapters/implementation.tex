\chapter{Implementation} % (fold)
\label{cha:implementation}

% TO-DO
This chapter focuses on software implementation aspects and related issues. We identify key attributes that Legacy must exhibit and describe the adopted approaches to tackle them. Overall, Legacy’s underlying implementation aims at building a robust application that inspires confidence from both users and investors.

As mentionned, Legacy’s core functionalities reside in the Ethereum blockchain platform \cite{Ethereum}. This aspect is perhaps the main competitive advantage of Legacy with respect to similar solutions, and also enables additional functionalities that have not been addressed by other services. 
%Before introducing Legacy’s general architecture, the reasons why a blockchain platform has been adopted are briefly discussed next.

% ---------------------------------------------------------------------------------------------------------------- %
% Why Blockchain
% ---------------------------------------------------------------------------------------------------------------- %
\section{Why Blockchain?} % (fold)
\label{sec:why_blockchain_}

The essential role of a blockchain consists on removing the dependency on trusted third parties in networks where nodes are non-reliable. In this way, any pair of nodes may exchange and process data securely without the intervention of intermediaries. In this way, Bitcoin eliminated the requirement for banks as validators of money transactions. The introduction of smart contracts has paved the way for many novel blockchain applications. Basically, smart contracts not only allow to securely perform peer-to-peer money transactions, but virtually any type of operation. In addition, smart contracts can be executed programmatically and in response to real world events (i.e., events outside of the blockchain). In our context, a blockchain platform supporting smart contracts also allows us to guarantee the main following properties: 

\begin{itemize}
	\item Authenticity: a will stored in the form of a smart contract allows to fully guarantee that all its content was actually dictated by its original author.
	\item Immutability: once a smart contract has been signed and uploaded to the blockchain, it cannot be modified nor deleted by attackers.
	\item Reliability: most blockchains consists of a large number of nodes that jointly validate the current system state. Smart contract data and transaction records are safely stored, validated and replicated at each network node. Hence, it is very difficult for an attacker to disrupt the network or corrupt the data.
\end{itemize}

% section why_blockchain_ (end)

% ---------------------------------------------------------------------------------------------------------------- %
% Technical Aspects
% ---------------------------------------------------------------------------------------------------------------- %
\section{Technical Aspects} % (fold)
\label{sec:technical_aspects}

\subsection{Data Storage} % (fold)
\label{sub:data_storage}
Using Ethereum smart contracts guarantees that the code is reliably stored and that user's dispositions, as specified in the contract, remain immutable in the long term (unless, of course, they are modified by the user himself). However, storing data directly on the blockchain is currently prohibitively expensive.
For instance, an SSTORE operation, which stores a 256-bit word on the Ethereum blockchain, costs 20000 gas \cite[Appendix G]{Wood}. Hence, storing 1 Gigabyte of data on the Ethereum blockchain would cost around 13000 ETH, or, equivalently, about 4 million USD\footnote{At the moment of writing these lines gas price is 21 Gwei and 1 ETH $\equiv$ 250 EUR.}.
In fact, due to the amount of overhead involved, blockchains are not designed for data storage, which is why it is disincentivized by imposing fees. 

As a consequence, data storage requires a different approach. Currently, several alternatives are being discussed and investigated by the Legacy team.
Among some identified third-party providers we may mention:

\begin{itemize}
	\item Swarm
	\item Usenet
	\item Storj
	\item Sia
	\item Filecoin
\end{itemize}

These are all based on decentralized architectures and have been considered as candidate solutions for Legacy.
In particular, blockchain-based file storage provides high reliability, DDOS resistance, fault tolerance, among other desirable attributes. 

To further improve storage reliability, more ``traditional'' services can be also considered, as for instance local storage (\textit{i.e.}, using Legacy's infrastructure), Glacier by Amazon, hubiC by OVH and Drive by Google.
%Combining proven and experimental storage methods will allow Legacy to be confident in its longevity promise.

Another approach for data storage consists on deploying a decentralized network of nodes running the IPFS protocol \cite{Benet}. Such a network would be composed by any individual or organization interested in offering storage services. In this case, the LEG token (see Section \ref{cha:the_legacy_token}) can be used to reward nodes offering storage services.
While this approach is essentially the same approach used by some of the blockchain-based storage services cited above, it provides the advantage of not being dependent on third parties.

% subsection data_storage (end)

\subsection{Proof of Life} % (fold)
\label{sub:proof_of_life}

The set of functions by which the system determines if a user has died is referred to as Proof of Life (PoL). The PoL engine can be implemented at different levels of the application (see for instance Figure~\ref{fig:leg_v1_arch}). It is configured by the user through the web or mobile interface and, internally, is commanded by the user smart contract instance. Several different sources of data can be used for PoL purposes, among which we may mention:
\begin{itemize}
	\item Online user activity: simple web plugins can be implemented in order to signal online user activity. To that end, each user is assigned a personal wallet (internally) that serves as interface with his or her smart contract. In this way, when a user logs-in in a given web application, a simple, empty transaction originated by the web plugin is sent from the user wallet to the user smart contract. Plugins can be integrated in social networks (e.g. Facebook and Twitter) and in the Legacy web interface as well.
	\item Using a mobile application: Legacy may obtain direct and indirect PoL signalling through a mobile application. For direct signalling, users can simply receive periodic notifications that can be acknowledged involving minimal interaction. Alternatively, upon user's consent, indirect PoL signalling can be obtained using a background process able to read whatever metadata is provided by the user. First-order information can be readily obtained by simply verifying that the mobile phone is active.
	\item Email notifications: users can signal activity by clicking on a link sent periodically from Legacy’s servers. This option is less practical but can be adopted whenever the above methods are not available or provide few information.
	\item Official data: Some governments offer official obituary databases that can be freely fetched through an API.  
	\item Human-assisted mechanisms: as an additional PoL layer, Legacy may directly contact one or more persons previously designated by the user. This mechanism is referred to as ``Layer-3 PoL'' in the simplified diagram shown in Figure \ref{fig:flow_chart}. While this option may go against the spirit of Legacy in that it involves intermediaries, it is also a valid alternative that may be preferred by the users in some cases (for instance, users may require to have third persons to validate and supervise the whole process).
\end{itemize}

The different PoL signalling channels are shown in Figure \ref{fig:leg_v1_arch}. Using this set of input data sources, a weighted algorithm determines the user state (alive/dead) with a given periodicity. The main input parameters, plugins and periodicity can be fully configurable by the user, and can also be adapted dynamically (\textit{i.e.}, after the user smart contract has been created). The options available for PoL may also vary according to user’s subscription packages because using additional mechanisms also results in increased transactions between the blockchain and external services, which in turn involves additional costs. 


\subsection{AI-aided Functionalities} % (fold)
\label{sub:ai_aided_functionalities}

% subsection ai_aided_functionalities (end)

\subsubsection{AI-aided PoL} % (fold)
\label{ssub:ai_based_pol}

While providing a large number of options to configure the PoL engine brings flexibility and a higher degree of certainty, it has an impact on the user experience. A simple way to tackle this problem is to offer a default configuration set-up with a few options. Alternatively, the use of artificial intelligence (AI) technology could greatly simplify the PoL interface, thus improving the user experience and provide an additional degree of certainty. AI-based PoL can be implemented as a first, default layer, transparent to the user, exploiting the same data sources mentioned above.

% subsubsection ai_based_pol (end)

\subsubsection{AI-aided Search for Beneficiaries} % (fold)
\label{ssub:ai_aided_search_for_beneficiaries}
Transferring digital assets from testators to beneficiaries involves also the problem of finding the right beneficiaries. Since contracts can be executed a long time after being configured and committed to the blockchain, beneficiaries may change they contact information or even die. 
AI technology can also help to mitigate this problem, for instance, by monitoring interaction between the user and his/her beneficiaries.

% subsubsection ai_aided_search_for_beneficiaries (end)


% subsection proof_of_life (end)

\subsection{Security} % (fold)
\label{sub:security}
Security is one of the key attributes that Legacy must exhibit in order to build confidence among the community. 
In particular, it is desirable to securely transfer digital assets without requiring the intervention of a trusted third party. 
While this can be easily achieved through the blockchain, this solution requires every beneficiary to hold an account in the network (\textit{i.e.}, a blockchain address allowing to send and receive digital assets) and hence it is not currently feasible.
However, it is highly likely that blockchains will be widely adopted in the future---specially if their usage is encouraged by governments---which would greatly simplify the problem.
In the meanwhile, a solution involving Legacy as a trusted third party is unavoidable.
Security also means that Legacy must be robust against attacks. Measures to enforce Legacy's security include a more rigorous code development methodology and scheduling regular code audits. Code audits by independent third parties are also considered.


% subsection security (end)

\subsection{Privacy} % (fold)
\label{sub:privacy}
Protecting user's privacy involves some issues. By definition, public blockchains like Ethereum do not offer privacy, which compromises user-related information stored therein. This is a problem that is currently undergoing active research and several solutions have been already proposed \cite{Buterin}. 

In Legacy's initial releases, most user data will not be stored directly on the blockchain (see Section \ref{sub:data_storage} above). In this way, data can be encrypted using robust algorithms without involving high complexity costs.
Legacy is also monitoring current research on zero-party privacy, which offers significant advantages. With zero-party privacy, transferring sensible data can be achieved without requiring trusted third parties---including the Legacy organization---to have access to the actual data involved in the transactions.
% subsection privacy (end)

\subsection{Long-term Service Availability} % (fold)
\label{sub:long_term_service_availability}
Clearly, Legacy must provide guarantees of sustainability in time. In many cases, in fact, user's capsules are transferred within a time span of at least several decades.  Ensuring service operation for such large time spans is one of the most important challenges of Legacy and requires taking multiple measures. 

From the point of view of the application architecture, the code must be able to evolve in time and be easily adaptable according to major technological changes. This is another reason why dependence on specific third-party services must be minimized, in particular on those who are based on centralized architectures. Instead, core functions of Legacy should be flexible and provide support for alternative solutions. In the long term, Legacy expects to be agnostic regarding its main dependencies (i.e. blockchain platform, storage and Oracle interface). This would allow, for instance, to migrate user’s smart contracts from one blockchain to another, in the eventuality that the former shows critical signs of scalability or stability issues. A blockchain-agnostic model also offers the possibility of setting up capsules into two parallel blockchains, if this option appears to be economically viable.    
% subsection long_term_service_availability (end)

Ensuring long-term service operation also requires to minimize the dependence on the Legacy organization itself. Indeed, users expect that their assets will be effectively distributed even in the eventuality that the Legacy organization is dissolved. 
This will be one of the fundamental roles of the Legacy Foundation. Among the measures foreseen in this case, Legacy is committed to publish an open source application allowing users to keep paying operational costs (\textit{i.e.}, fees required for blockchain transactions and storage) in order to ensure continuous operation. The Legacy foundation will be in charge of maintaining the code and guaranteeing its functionality.

%\subsection{A Reward System to Reinforce Long-term Service Availability} % (fold)
% to-do
%\label{sub:a_reward_system_to_reinforce_long_term_service_availability}

% subsection a_reward_system_to_reinforce_long_term_service_availability (end)

% section technical_aspects (end)



% chapter implementation (end)
